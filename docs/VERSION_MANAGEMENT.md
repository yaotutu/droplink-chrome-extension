# ç‰ˆæœ¬å·ç®¡ç†æŒ‡å—

## ğŸ“‹ ç‰ˆæœ¬å·ç­–ç•¥

### å•ä¸€æ•°æ®æºåŸåˆ™
**`package.json` æ˜¯å”¯ä¸€çš„ç‰ˆæœ¬å·æ¥æº**

æ‰€æœ‰ç‰ˆæœ¬å·éƒ½ä» `package.json` çš„ `version` å­—æ®µè¯»å–ï¼Œç¡®ä¿ä¸€è‡´æ€§ã€‚

---

## ğŸ”„ ç‰ˆæœ¬å·æµç¨‹

### 1. å¼€å‘ç‰ˆ (dev-latest)
**è§¦å‘**: æ¨é€åˆ° `dev` åˆ†æ”¯

**ç‰ˆæœ¬å·**: åŸºäº Git æäº¤æ€»æ•°ï¼ˆè‡ªåŠ¨é€’å¢ï¼‰
```
1.0.42-dev  (42 æ˜¯æäº¤æ€»æ•°)
```

**æ–‡ä»¶å**: `droplink-dev-1.0.42-dev.zip`

**ç”¨é€”**:
- æ—¥å¸¸å¼€å‘æµ‹è¯•
- å¿«é€Ÿè¿­ä»£
- è‡ªåŠ¨æ„å»º

---

### 2. æ­£å¼ç‰ˆ (main-latest) â­
**è§¦å‘**: æ¨é€åˆ° `master` åˆ†æ”¯

**ç‰ˆæœ¬å·**: ä» `package.json` è¯»å–
```json
{
  "version": "1.0.0"
}
```

**æ–‡ä»¶å**: `droplink-v1.0.0.zip`

**è‡ªåŠ¨å½’æ¡£**: åŒæ—¶åˆ›å»º `v1.0.0` Release ç”¨äºå†å²å½’æ¡£

**ç”¨é€”**:
- ç¨³å®šå‘å¸ƒ
- ç”¨æˆ·ä¸‹è½½
- æ‰©å±•æ˜¾ç¤ºçš„ç‰ˆæœ¬å·
- è‡ªåŠ¨ä¿ç•™å†å²ç‰ˆæœ¬

---

### 3. å†å²å½’æ¡£ç‰ˆæœ¬ (v1.0.0)
**è§¦å‘**: æ¨é€åˆ° `master` åˆ†æ”¯æ—¶è‡ªåŠ¨åˆ›å»º

**ç‰ˆæœ¬å·**: ä¸ `package.json` ä¸€è‡´

**æ–‡ä»¶å**: `droplink-v1.0.0.zip`

**ç”¨é€”**:
- è‡ªåŠ¨å½’æ¡£æ¯ä¸ªæ­£å¼ç‰ˆæœ¬
- ç”¨æˆ·å¯ä»¥ä¸‹è½½å†å²ç‰ˆæœ¬
- ä¸ä¼šè¢«è¦†ç›–ï¼Œæ°¸ä¹…ä¿ç•™

---

## ğŸ“ å¦‚ä½•å‘å¸ƒæ–°ç‰ˆæœ¬

### æ–¹æ³• 1: è‡ªåŠ¨å‘å¸ƒï¼ˆæ¨èï¼‰

1. **ä¿®æ”¹ç‰ˆæœ¬å·**
   ```bash
   # ç¼–è¾‘ package.json
   {
     "version": "1.1.0"  # ä» 1.0.0 æ”¹ä¸º 1.1.0
   }
   ```

2. **æäº¤å¹¶æ¨é€åˆ° master**
   ```bash
   git add package.json
   git commit -m "chore: bump version to 1.1.0"
   git push origin master
   ```

3. **GitHub Actions è‡ªåŠ¨æ„å»º**
   - è¯»å– package.json çš„ç‰ˆæœ¬å· `1.1.0`
   - æ„å»ºæ‰©å±•
   - å‘å¸ƒåˆ° `main-latest` Releaseï¼ˆè¦†ç›–æ—§ç‰ˆæœ¬ï¼‰
   - **è‡ªåŠ¨åˆ›å»º `v1.1.0` Release ç”¨äºå†å²å½’æ¡£**
   - æ–‡ä»¶å: `droplink-v1.1.0.zip`

4. **ç”¨æˆ·çœ‹åˆ°çš„ç‰ˆæœ¬å·**
   - æ‰©å±•è®¾ç½®é¡µé¢: `v1.1.0`
   - ä¸‹è½½æ–‡ä»¶å: `droplink-v1.1.0.zip`
   - main-latest Release: `v1.1.0`ï¼ˆæœ€æ–°ç‰ˆï¼Œä¼šè¢«è¦†ç›–ï¼‰
   - v1.1.0 Release: `v1.1.0`ï¼ˆå†å²å½’æ¡£ï¼Œæ°¸ä¹…ä¿ç•™ï¼‰
   - **å®Œå…¨ä¸€è‡´ï¼** âœ…

---

### æ–¹æ³• 2: ä½¿ç”¨ npm version å‘½ä»¤

```bash
# è‡ªåŠ¨æ›´æ–° package.json å¹¶åˆ›å»º git commit
npm version patch  # 1.0.0 -> 1.0.1
npm version minor  # 1.0.0 -> 1.1.0
npm version major  # 1.0.0 -> 2.0.0

# æ¨é€åˆ° master
git push origin master
```

---

### æ–¹æ³• 3: ~~åˆ›å»ºç‰¹å®šç‰ˆæœ¬ Tag~~ï¼ˆå·²åºŸå¼ƒï¼‰

~~ä¸å†éœ€è¦æ‰‹åŠ¨åˆ›å»º Git Tagï¼Œæ¨é€åˆ° master åˆ†æ”¯æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºç‰ˆæœ¬å½’æ¡£ã€‚~~

---

## ğŸ¯ ç‰ˆæœ¬å·è§„èŒƒ

### è¯­ä¹‰åŒ–ç‰ˆæœ¬ (Semantic Versioning)

æ ¼å¼: `MAJOR.MINOR.PATCH`

- **MAJOR**: é‡å¤§æ›´æ–°ï¼Œä¸å…¼å®¹çš„ API å˜æ›´ (1.0.0 â†’ 2.0.0)
- **MINOR**: æ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹ (1.0.0 â†’ 1.1.0)
- **PATCH**: Bug ä¿®å¤ï¼Œå‘åå…¼å®¹ (1.0.0 â†’ 1.0.1)

### ç¤ºä¾‹

| å˜æ›´ç±»å‹ | ç‰ˆæœ¬å˜åŒ– | è¯´æ˜ |
|---------|---------|------|
| ä¿®å¤ Bug | 1.0.0 â†’ 1.0.1 | PATCH |
| æ–°å¢åŠŸèƒ½ | 1.0.0 â†’ 1.1.0 | MINOR |
| é‡å¤§é‡æ„ | 1.0.0 â†’ 2.0.0 | MAJOR |

---

## ğŸ“Š ç‰ˆæœ¬å·å¯¹æ¯”è¡¨

| ä½ç½® | ç‰ˆæœ¬å·æ¥æº | ç¤ºä¾‹ | ä¸€è‡´æ€§ |
|------|-----------|------|--------|
| **package.json** | æ‰‹åŠ¨ç»´æŠ¤ | `1.0.0` | âœ… å•ä¸€æ•°æ®æº |
| **æ‰©å±•æ˜¾ç¤º** | è¯»å– manifest.json | `v1.0.0` | âœ… æ¥è‡ª package.json |
| **main-latest** | è¯»å– package.json | `v1.0.0` | âœ… æ¥è‡ª package.json |
| **æ–‡ä»¶å** | è¯»å– package.json | `droplink-v1.0.0.zip` | âœ… æ¥è‡ª package.json |
| **dev-latest** | Git æäº¤æ•° | `1.0.42-dev` | âš ï¸ å¼€å‘ç‰ˆï¼Œæ— æ‰€è°“ |

---

## âœ… æœ€ä½³å®è·µ

### 1. å‘å¸ƒå‰æ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤ `package.json` ç‰ˆæœ¬å·æ­£ç¡®
- [ ] è¿è¡Œ `pnpm build` ç¡®ä¿æ„å»ºæˆåŠŸ
- [ ] æµ‹è¯•æ‰©å±•åŠŸèƒ½æ­£å¸¸
- [ ] æäº¤åˆ° main åˆ†æ”¯
- [ ] ç­‰å¾… GitHub Actions æ„å»ºå®Œæˆ
- [ ] éªŒè¯ Release é¡µé¢ç‰ˆæœ¬å·æ­£ç¡®

### 2. ç‰ˆæœ¬å·å‘½åå»ºè®®

```bash
# å¼€å‘é˜¶æ®µ
1.0.0-alpha.1  # å†…éƒ¨æµ‹è¯•
1.0.0-beta.1   # å…¬å¼€æµ‹è¯•
1.0.0-rc.1     # å€™é€‰ç‰ˆæœ¬

# æ­£å¼ç‰ˆæœ¬
1.0.0          # é¦–æ¬¡å‘å¸ƒ
1.0.1          # Bug ä¿®å¤
1.1.0          # æ–°åŠŸèƒ½
2.0.0          # é‡å¤§æ›´æ–°
```

### 3. æäº¤ä¿¡æ¯è§„èŒƒ

```bash
# ç‰ˆæœ¬æ›´æ–°æäº¤
git commit -m "chore: bump version to 1.1.0"

# åŠŸèƒ½å¼€å‘æäº¤
git commit -m "feat: add dark mode support"

# Bug ä¿®å¤æäº¤
git commit -m "fix: resolve login timeout issue"
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€ç‰ˆæœ¬å·ï¼Ÿ
**A**: é¿å…æ··ä¹±ï¼ç”¨æˆ·çœ‹åˆ°çš„ç‰ˆæœ¬å·åº”è¯¥å’Œä¸‹è½½çš„æ–‡ä»¶åä¸€è‡´ã€‚

### Q: å¦‚ä½•å›æ»šç‰ˆæœ¬ï¼Ÿ
**A**:
```bash
# æ–¹æ³• 1: ä¿®æ”¹ package.json å¹¶æ¨é€
# æ–¹æ³• 2: ä½¿ç”¨ git revert
git revert <commit-hash>
git push origin master
```

### Q: dev ç‰ˆæœ¬å·ä¸ºä»€ä¹ˆä¸åŒï¼Ÿ
**A**: dev ç‰ˆæœ¬ä½¿ç”¨æäº¤è®¡æ•°ï¼Œæ–¹ä¾¿è‡ªåŠ¨æ„å»ºã€‚æ­£å¼ç‰ˆæ‰éœ€è¦ç»Ÿä¸€ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ï¼Ÿ
**A**:
```bash
# æŸ¥çœ‹ package.json
cat package.json | grep version

# æˆ–ä½¿ç”¨ node
node -p "require('./package.json').version"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ](https://semver.org/lang/zh-CN/)
- [npm version å‘½ä»¤](https://docs.npmjs.com/cli/v8/commands/npm-version)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)

---

## ğŸ‰ æ€»ç»“

**è®°ä½ä¸€å¥è¯**ï¼š`package.json` æ˜¯ç‰ˆæœ¬å·çš„å”¯ä¸€æ¥æºï¼

ä¿®æ”¹ç‰ˆæœ¬å· â†’ æ¨é€åˆ° master â†’ è‡ªåŠ¨æ„å»º â†’ ç‰ˆæœ¬å·ä¸€è‡´ âœ…

---

## ğŸ—ï¸ GitHub Actions æ¶æ„

### å…±äº« Workflow è®¾è®¡

ä¸ºäº†é¿å…ä»£ç é‡å¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† **å¯å¤ç”¨ workflow** æ¶æ„ï¼š

```
build-shared.yml (å…±äº«é€»è¾‘)
    â†‘              â†‘
    â”‚              â”‚
dev-build.yml  main-build.yml
(è°ƒç”¨è€…)        (è°ƒç”¨è€…)
```

**ä¼˜åŠ¿**ï¼š
- âœ… **DRY åŸåˆ™**ï¼šæ„å»ºé€»è¾‘åªå†™ä¸€æ¬¡ï¼Œé¿å…é‡å¤
- âœ… **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹æ„å»ºé€»è¾‘åªéœ€æ”¹ä¸€ä¸ªæ–‡ä»¶
- âœ… **å‚æ•°åŒ–é…ç½®**ï¼šé€šè¿‡å‚æ•°æ§åˆ¶ä¸åŒè¡Œä¸º
- âœ… **ç±»å‹å®‰å…¨**ï¼šworkflow_call æä¾›å‚æ•°éªŒè¯

### å…³é”®å·®å¼‚å‚æ•°

| å‚æ•° | dev-build | main-build |
|------|-----------|------------|
| `branch_name` | dev | master |
| `release_tag` | dev-latest | main-latest |
| `use_commit_count` | true | false |
| `file_prefix` | droplink-dev- | droplink-v |
| `is_prerelease` | true | false |

### ç‰ˆæœ¬å·é€»è¾‘

```yaml
# build-shared.yml ä¸­çš„ç‰ˆæœ¬å·é€»è¾‘
if [ "$use_commit_count" = "true" ]; then
  # Dev ç‰ˆæœ¬ï¼šä½¿ç”¨æäº¤è®¡æ•°
  VERSION_NAME="1.0.${COMMIT_COUNT}-dev"
else
  # æ­£å¼ç‰ˆæœ¬ï¼šä» package.json è¯»å–
  VERSION_NAME=$(node -p "require('./package.json').version")
fi
```
