<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯•é€šçŸ¥è¿‡æ»¤ - Droplink</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #2196f3;
      padding-bottom: 10px;
    }
    .section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .config-group {
      margin: 15px 0;
    }
    label {
      display: block;
      font-weight: 500;
      margin-bottom: 5px;
      color: #555;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      padding: 12px 24px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }
    .btn-primary {
      background: #2196f3;
      color: white;
    }
    .btn-primary:hover {
      background: #1976d2;
    }
    .btn-success {
      background: #4caf50;
      color: white;
    }
    .btn-success:hover {
      background: #388e3c;
    }
    .btn-warning {
      background: #ff9800;
      color: white;
    }
    .btn-warning:hover {
      background: #f57c00;
    }
    .btn-danger {
      background: #f44336;
      color: white;
    }
    .btn-danger:hover {
      background: #d32f2f;
    }
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .hint {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 4px;
      font-size: 13px;
      color: #1565c0;
      margin-top: 10px;
    }
    .test-case {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 4px;
      border-left: 4px solid #2196f3;
      margin: 10px 0;
    }
    .test-case h4 {
      margin: 0 0 10px 0;
      color: #333;
    }
    .test-case p {
      margin: 5px 0;
      font-size: 13px;
      color: #666;
    }
    .log {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .log-error {
      color: #ef5350;
    }
    .log-success {
      color: #66bb6a;
    }
    .log-info {
      color: #64b5f6;
    }
  </style>
</head>
<body>
  <h1>ğŸ“¨ Droplink é€šçŸ¥è¿‡æ»¤æµ‹è¯•å·¥å…·</h1>

  <!-- é…ç½®éƒ¨åˆ† -->
  <div class="section">
    <h3>âš™ï¸ é…ç½®</h3>
    <div class="config-group">
      <label>Gotify æœåŠ¡å™¨åœ°å€:</label>
      <input type="text" id="gotifyUrl" value="http://111.228.1.24:2345" placeholder="http://your-server:2345">
    </div>
    <div class="config-group">
      <label>åº”ç”¨ Tokenï¼ˆç”¨äºå‘é€æ¶ˆæ¯ï¼‰:</label>
      <input type="text" id="appToken" placeholder="ç²˜è´´åº”ç”¨ Token">
    </div>
    <div class="hint">
      ğŸ’¡ <strong>æ³¨æ„ï¼š</strong>è¿™é‡Œéœ€è¦çš„æ˜¯<strong>åº”ç”¨ Token</strong>ï¼ˆç”¨äºå‘é€æ¶ˆæ¯ï¼‰ï¼Œä¸æ˜¯å®¢æˆ·ç«¯ Tokenï¼<br>
      åœ¨ Gotify è®¾ç½® â†’ Appsï¼ˆåº”ç”¨ï¼‰ä¸­åˆ›å»ºåº”ç”¨å¹¶è·å– Tokenã€‚
    </div>
  </div>

  <!-- æµ‹è¯•åœºæ™¯è¯´æ˜ -->
  <div class="section">
    <h3>ğŸ“‹ æµ‹è¯•åœºæ™¯</h3>
    <p>é…ç½®å¥½æ‰©å±•åï¼Œç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å‘é€æµ‹è¯•æ¶ˆæ¯ï¼ŒéªŒè¯è¿‡æ»¤è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆï¼š</p>

    <div class="test-case">
      <h4>åœºæ™¯ 1ï¼šåŒ…å«è§„åˆ™æµ‹è¯•</h4>
      <p><strong>è§„åˆ™é…ç½®ï¼š</strong>æ·»åŠ åŒ…å«è§„åˆ™ "éªŒè¯ç "</p>
      <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
      <ul>
        <li>âœ… åŒ…å«"éªŒè¯ç "çš„æ¶ˆæ¯ â†’ æ˜¾ç¤ºé€šçŸ¥</li>
        <li>âŒ ä¸åŒ…å«"éªŒè¯ç "çš„æ¶ˆæ¯ â†’ ä¸æ˜¾ç¤ºé€šçŸ¥</li>
      </ul>
    </div>

    <div class="test-case">
      <h4>åœºæ™¯ 2ï¼šä¸åŒ…å«è§„åˆ™æµ‹è¯•</h4>
      <p><strong>è§„åˆ™é…ç½®ï¼š</strong>æ·»åŠ ä¸åŒ…å«è§„åˆ™ "å¹¿å‘Š"</p>
      <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
      <ul>
        <li>âœ… ä¸åŒ…å«"å¹¿å‘Š"çš„æ¶ˆæ¯ â†’ æ˜¾ç¤ºé€šçŸ¥</li>
        <li>âŒ åŒ…å«"å¹¿å‘Š"çš„æ¶ˆæ¯ â†’ ä¸æ˜¾ç¤ºé€šçŸ¥</li>
      </ul>
    </div>

    <div class="test-case">
      <h4>åœºæ™¯ 3ï¼šæ··åˆè§„åˆ™æµ‹è¯•</h4>
      <p><strong>è§„åˆ™é…ç½®ï¼š</strong>åŒ…å«"é‡è¦" + ä¸åŒ…å«"å¹¿å‘Š"</p>
      <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
      <ul>
        <li>âœ… "é‡è¦é€šçŸ¥" â†’ æ˜¾ç¤º</li>
        <li>âŒ "é‡è¦å¹¿å‘Š" â†’ ä¸æ˜¾ç¤ºï¼ˆexclude ä¼˜å…ˆï¼‰</li>
        <li>âŒ "æ™®é€šæ¶ˆæ¯" â†’ ä¸æ˜¾ç¤ºï¼ˆä¸åŒ¹é… includeï¼‰</li>
      </ul>
    </div>

    <div class="test-case">
      <h4>åœºæ™¯ 4ï¼šOpenTab è¿‡æ»¤æµ‹è¯•</h4>
      <p><strong>è§„åˆ™é…ç½®ï¼š</strong>å¯ç”¨"è¿‡æ»¤ OpenTab æ¶ˆæ¯"</p>
      <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
      <ul>
        <li>âŒ OpenTab æ¶ˆæ¯ â†’ ä¸æ˜¾ç¤ºé€šçŸ¥ï¼ˆå³ä½¿åŒ¹é…å…¶ä»–è§„åˆ™ï¼‰</li>
        <li>âœ… æ™®é€šæ¶ˆæ¯ â†’ æŒ‰è§„åˆ™æ­£å¸¸è¿‡æ»¤</li>
      </ul>
    </div>
  </div>

  <!-- æµ‹è¯•æŒ‰é’® -->
  <div class="section">
    <h3>ğŸ§ª å¿«é€Ÿæµ‹è¯•</h3>

    <h4>åŸºç¡€æµ‹è¯•ï¼š</h4>
    <div class="test-grid">
      <button class="btn-success" onclick="sendTest('éªŒè¯ç ', 'æ‚¨çš„éªŒè¯ç æ˜¯ 123456')">
        âœ… åŒ…å«"éªŒè¯ç "
      </button>
      <button class="btn-danger" onclick="sendTest('æ™®é€šæ¶ˆæ¯', 'è¿™æ˜¯ä¸€æ¡æ™®é€šæ¶ˆæ¯')">
        âŒ ä¸åŒ…å«"éªŒè¯ç "
      </button>
      <button class="btn-warning" onclick="sendTest('å¹¿å‘Šæ¶ˆæ¯', 'è¿™æ˜¯ä¸€æ¡å¹¿å‘Šå†…å®¹')">
        âš ï¸ åŒ…å«"å¹¿å‘Š"
      </button>
      <button class="btn-success" onclick="sendTest('é‡è¦é€šçŸ¥', 'è¿™æ˜¯é‡è¦çš„ç³»ç»Ÿé€šçŸ¥')">
        âœ… åŒ…å«"é‡è¦"
      </button>
    </div>

    <h4 style="margin-top: 20px;">æ··åˆæµ‹è¯•ï¼š</h4>
    <div class="test-grid">
      <button class="btn-success" onclick="sendTest('é‡è¦æ¶ˆæ¯', 'é‡è¦ï¼šç³»ç»Ÿæ›´æ–°é€šçŸ¥')">
        åŒ…å«"é‡è¦"
      </button>
      <button class="btn-danger" onclick="sendTest('é‡è¦å¹¿å‘Š', 'é‡è¦å¹¿å‘Šä¿¡æ¯')">
        åŒ…å«"é‡è¦"+"å¹¿å‘Š"
      </button>
      <button class="btn-primary" onclick="sendTest('ç³»ç»Ÿæé†’', 'æ‚¨æœ‰æ–°çš„ç³»ç»Ÿæ¶ˆæ¯')">
        æ™®é€šæ¶ˆæ¯
      </button>
    </div>

    <h4 style="margin-top: 20px;">OpenTab æµ‹è¯•ï¼š</h4>
    <div class="test-grid">
      <button class="btn-primary" onclick="sendOpenTabMessage('https://www.google.com', 'æ‰“å¼€ Google')">
        ğŸ”— OpenTab æ¶ˆæ¯
      </button>
      <button class="btn-success" onclick="sendOpenTabMessage('https://github.com', 'åŒ…å«éªŒè¯ç çš„ OpenTab')">
        ğŸ”— OpenTab + "éªŒè¯ç "
      </button>
    </div>

    <h4 style="margin-top: 20px;">æ‰¹é‡æµ‹è¯•ï¼š</h4>
    <button class="btn-primary" onclick="sendBatchTests()" style="width: 100%;">
      ğŸš€ å‘é€ 10 æ¡æµ‹è¯•æ¶ˆæ¯ï¼ˆæ¯ç§’ä¸€æ¡ï¼‰
    </button>
  </div>

  <!-- æ—¥å¿—è¾“å‡º -->
  <div class="section">
    <h3>ğŸ“Š å‘é€æ—¥å¿—</h3>
    <div class="log" id="log">ç­‰å¾…å‘é€æ¶ˆæ¯...</div>
    <button class="btn-warning" onclick="clearLog()" style="margin-top: 10px;">æ¸…ç©ºæ—¥å¿—</button>
  </div>

  <script>
    const log = document.getElementById('log');

    function addLog(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString('zh-CN');
      const className = `log-${type}`;
      log.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
      log.scrollTop = log.scrollHeight;
    }

    function clearLog() {
      log.innerHTML = 'æ—¥å¿—å·²æ¸…ç©º';
    }

    async function sendTest(title, message) {
      const gotifyUrl = document.getElementById('gotifyUrl').value;
      const appToken = document.getElementById('appToken').value;

      if (!gotifyUrl || !appToken) {
        alert('è¯·å…ˆå¡«å†™ Gotify æœåŠ¡å™¨åœ°å€å’Œåº”ç”¨ Tokenï¼');
        return;
      }

      const payload = {
        title: title,
        message: message,
        priority: 5
      };

      addLog(`å‘é€æ™®é€šæ¶ˆæ¯: ${title}`, 'info');

      try {
        const response = await fetch(`${gotifyUrl}/message?token=${appToken}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          addLog(`âœ… æˆåŠŸ: "${title}" - "${message}"`, 'success');
        } else {
          const error = await response.text();
          addLog(`âŒ å¤±è´¥: ${response.status} - ${error}`, 'error');
        }
      } catch (error) {
        addLog(`âŒ é”™è¯¯: ${error.message}`, 'error');
      }
    }

    async function sendOpenTabMessage(url, title) {
      const gotifyUrl = document.getElementById('gotifyUrl').value;
      const appToken = document.getElementById('appToken').value;

      if (!gotifyUrl || !appToken) {
        alert('è¯·å…ˆå¡«å†™ Gotify æœåŠ¡å™¨åœ°å€å’Œåº”ç”¨ Tokenï¼');
        return;
      }

      const payload = {
        title: title,
        message: `è‡ªåŠ¨æ‰“å¼€é“¾æ¥: ${url}`,
        priority: 5,
        extras: {
          droplink: {
            action: "openTab",
            url: url,
            options: {
              activate: true
            }
          }
        }
      };

      addLog(`å‘é€ OpenTab æ¶ˆæ¯: ${title} â†’ ${url}`, 'info');

      try {
        const response = await fetch(`${gotifyUrl}/message?token=${appToken}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          addLog(`âœ… æˆåŠŸ: OpenTab "${title}"`, 'success');
        } else {
          const error = await response.text();
          addLog(`âŒ å¤±è´¥: ${response.status} - ${error}`, 'error');
        }
      } catch (error) {
        addLog(`âŒ é”™è¯¯: ${error.message}`, 'error');
      }
    }

    async function sendBatchTests() {
      const tests = [
        { title: 'éªŒè¯ç é€šçŸ¥ 1', message: 'æ‚¨çš„éªŒè¯ç æ˜¯ 123456' },
        { title: 'æ™®é€šæ¶ˆæ¯ 1', message: 'è¿™æ˜¯ä¸€æ¡æ™®é€šæ¶ˆæ¯' },
        { title: 'éªŒè¯ç é€šçŸ¥ 2', message: 'éªŒè¯ç ï¼š789012' },
        { title: 'å¹¿å‘Šæ¶ˆæ¯', message: 'é™æ—¶å¹¿å‘Šä¼˜æƒ ' },
        { title: 'é‡è¦é€šçŸ¥', message: 'é‡è¦ï¼šç³»ç»Ÿç»´æŠ¤é€šçŸ¥' },
        { title: 'é‡è¦å¹¿å‘Š', message: 'é‡è¦å¹¿å‘Šï¼šæ–°å“ä¸Šçº¿' },
        { title: 'æ™®é€šæ¶ˆæ¯ 2', message: 'æ‚¨æœ‰æ–°çš„æ¶ˆæ¯' },
        { title: 'éªŒè¯ç é€šçŸ¥ 3', message: 'code: 456789' },
        { title: 'ç³»ç»Ÿæ¶ˆæ¯', message: 'ç³»ç»Ÿè‡ªåŠ¨å¤‡ä»½å®Œæˆ' },
        { title: 'æµ‹è¯•æ¶ˆæ¯', message: 'è¿™æ˜¯æµ‹è¯•æ¶ˆæ¯' }
      ];

      addLog('ğŸš€ å¼€å§‹æ‰¹é‡å‘é€ 10 æ¡æ¶ˆæ¯...', 'info');

      for (let i = 0; i < tests.length; i++) {
        await sendTest(tests[i].title, tests[i].message);
        if (i < tests.length - 1) {
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
      }

      addLog('âœ… æ‰¹é‡å‘é€å®Œæˆï¼', 'success');
    }
  </script>
</body>
</html>
